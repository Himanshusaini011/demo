<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - ArtGallery</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.0.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.0.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // Helper function to decode JWT
        function parseJwt(token) {
            if (!token) { return null; }
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                return null;
            }
        }

        const AdminPage = () => {
            const [paintings, setPaintings] = React.useState([]);
            const [error, setError] = React.useState('');
            const [newPainting, setNewPainting] = React.useState({ title: '', artist: '', price: '', image: '' });
            const token = localStorage.getItem('authToken');
            const user = parseJwt(token);

            const fetchPaintings = async () => {
                try {
                    const response = await fetch('http://localhost:4000/api/paintings');
                    if (!response.ok) throw new Error('Failed to fetch paintings.');
                    const data = await response.json();
                    setPaintings(data);
                } catch (err) {
                    setError(err.message);
                }
            };

            React.useEffect(() => {
                // Redirect if not logged in OR if the user is not an admin
                if (!user || user.role !== 'admin') {
                    window.location.href = './index.html'; 
                    return;
                }
                fetchPaintings();
            }, [user?.role]);

            const handleDelete = async (id) => {
                if (!confirm('Are you sure you want to delete this painting?')) return;

                try {
                    const response = await fetch(`http://localhost:4000/api/paintings/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!response.ok) {
                        const data = await response.json();
                        throw new Error(data.message || 'Failed to delete painting.');
                    }

                    // Refresh the list of paintings
                    fetchPaintings();

                } catch (err) {
                    setError(err.message);
                }
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setNewPainting(prevState => ({ ...prevState, [name]: value }));
            };

            const handleAddPainting = async (e) => {
                e.preventDefault();
                setError('');

                try {
                    const response = await fetch('http://localhost:4000/api/paintings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(newPainting)
                    });

                    if (!response.ok) {
                        const data = await response.json();
                        throw new Error(data.message || 'Failed to add painting.');
                    }

                    // Clear form and refresh list
                    setNewPainting({ title: '', artist: '', price: '', image: '' });
                    fetchPaintings();

                } catch (err) {
                    setError(err.message);
                }
            };

            if (!user || user.role !== 'admin') {
                return (
                    <div className="text-center p-10">
                        <h2 className="text-2xl font-bold">Access Denied</h2>
                        <p>You must be an administrator to view this page.</p>
                    </div>
                );
            }

            return (
                <div className="container mx-auto p-8">
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="text-3xl font-bold">Admin - Manage Paintings</h1>
                        <a href="./index.html" className="text-indigo-600 hover:text-indigo-800 font-semibold">&larr; Back to Site</a>
                    </div>

                    {error && <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6" role="alert">{error}</div>}

                    {/* Add New Painting Form */}
                    <div className="bg-white p-6 rounded-lg shadow-md mb-8">
                        <h2 className="text-2xl font-semibold mb-4">Add New Painting</h2>
                        <form onSubmit={handleAddPainting} className="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                            <input name="title" value={newPainting.title} onChange={handleInputChange} placeholder="Title" className="md:col-span-1 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" required />
                            <input name="artist" value={newPainting.artist} onChange={handleInputChange} placeholder="Artist" className="md:col-span-1 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" required />
                            <input name="price" value={newPainting.price} onChange={handleInputChange} placeholder="Price" type="number" className="md:col-span-1 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" required />
                            <input name="image" value={newPainting.image} onChange={handleInputChange} placeholder="Image URL" className="md:col-span-1 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" required />
                            <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded w-full">Add Painting</button>
                        </form>
                    </div>

                    {/* Paintings List */}
                    <div className="bg-white rounded-lg shadow-md overflow-hidden">
                        <table className="w-full">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="text-left font-semibold text-gray-600 p-4">Painting</th>
                                    <th className="text-left font-semibold text-gray-600 p-4">Artist</th>
                                    <th className="text-left font-semibold text-gray-600 p-4">Price</th>
                                    <th className="text-right font-semibold text-gray-600 p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {paintings.map(p => (
                                    <tr key={p._id} className="border-t hover:bg-gray-50">
                                        <td className="p-4">
                                            <div className="flex items-center">
                                                <img src={p.image} alt={p.title} className="w-16 h-12 object-cover rounded-md mr-4"/>
                                                <span className="font-semibold">{p.title}</span>
                                            </div>
                                        </td>
                                        <td className="p-4 text-gray-700">{p.artist}</td>
                                        <td className="p-4 text-gray-700">${p.price}</td>
                                        <td className="p-4 text-right">
                                            <button 
                                                onClick={() => handleDelete(p._id)}
                                                className="text-red-500 hover:text-red-700"
                                                title="Delete Painting"
                                            >
                                                <i className="fas fa-trash-alt"></i>
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<AdminPage />, document.getElementById('root'));
    </script>
</body>
</html>

```

### How to Use It

1.  **Save the Files:** Make sure you've saved the updated `server.js` and the new `admin.html`.
2.  **Restart Your Backend:** Stop your `node server.js` process with `Ctrl+C` and restart it to load the new code. Your frontend server (`npx serve`) can keep running.
3.  **Log In:** Go to `http://localhost:3000/auth.html` and log in with a user account. You will be redirected to the home page.
4.  **Access the Admin Page:** Manually navigate to `http://localhost:3000/admin.html`.
    *   If you are logged in, you will see the admin panel with a list of paintings and a form to add a new one.
    *   If you are not logged in, the page will automatically redirect you to the login page.
5.  **Test the Features:**
    *   Try deleting a painting by clicking the trash can icon.
    *   Fill out the form and add a new painting.
    *   Go back to the main site (`index.html`) to see your changes reflected!

You now have a powerful, secure way to manage your gallery's inventory.

<!--
[PROMPT_SUGGESTION]How can I add an "Edit" button to update painting details?[/PROMPT_SUGGESTION]
[PROMPT_SUGGESTION]How can I make it so only specific users (like admins) can access the admin page?[/PROMPT_SUGGESTION]
-->